<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="schedule.css">
    <script src="script.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-m33EJpI/GR4gF5hjumkW5NU2XKZf7vBv8j2jMQ1MwW7VR+Yc3Ws5r1r7SdNhTq5+9zBdZ3e1Wl4vUc7flMiv2g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <div class="container">
    <!-- Left Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <img src="../assets/images/img1.png" alt="Logo">
            <span class="logo-text">Malnad College <br>of Engineering</span>
        </div>
      <nav class="sidebar-nav">
        <ul>
            <li><a href="home.html"><i class="bi bi-house-fill"></i> Home</a></li>
            <li class="active"><a href="schedule.html"><i class="bi bi-calendar3" style="color: black;"></i> Schedule</a></li>
            <li><a href="materials.html"><i class="bi bi-envelope-paper-fill"></i> Materials</a></li>
            <li><a href="assignments.html"><i class="bi bi-clipboard-check-fill"></i> Assignments</a></li>
            <li><a href="exams.html"><i class="bi bi-pen-fill"></i> Conduct Exams</a></li>
            <li><a href="faq.html"><i class="bi bi-question-lg"></i> FAQs</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content Area -->
      <main class="main-content">
        <header class="main-header">
          <div class="page-title">
            <h1>Schedule</h1>
          </div>
          <div class="header-actions">
            <div class="date-time">
              <p id="date-time">Loading...</p> <!-- JavaScript will update this -->
            </div>
            <div class="icons">
                <a href="#" id="gearIcon"><i class="bi bi-gear-fill"></i></a>
              <div class="dropdown">
                <a href="#" id="personIcon"><i class="bi bi-person-fill"></i></a>
                  <div class="dropdown-content">
                    <a href="index.html" id="logoutBtn">Logout</a>
                  </div>
              </div>
            </div>
        </header>
<hr>
      <!-- Upload Section -->
      <section class="upload-section">
           <div class="upload-container">
             <h2>Upload PDF Files</h2>
                <form id="scheduleForm" action="/schedule" method="POST" enctype="multipart/form-data">
                   <input type="file" id="fileInput" name="file" accept="application/pdf" required>
                   <button type="submit">Upload</button>
                </form>
           </div>   
      </section>
      
      <!-- Display Uploaded Timetable -->
      <section class="uploaded-timetable">
        <h2>Timetable</h2>
        <div class="timetable-content" id="timetable-content">
          <!-- PDF content will be displayed here -->
          <div id="uploadedFile"></div>
          
        </div>
      </section>


    </main>
  </div>

  <script>

    // Update date and time dynamically
    function updateTime() {
      const now = new Date();
      const dateTime = now.toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });
      document.getElementById('date-time').textContent = dateTime;
    }
    
    updateTime(); 
    setInterval(updateTime, 1000); 

        async function fetchUploadedFile() {
            const response = await fetch('/single-file');
            const file = await response.json();
            const uploadedFileDiv = document.getElementById('uploadedFile');

            // Clear previous upload
            uploadedFileDiv.innerHTML = '';

            if (file.url) {
                const iframe = document.createElement('iframe');
                iframe.src = file.url;
                iframe.width = '100%';
                iframe.height = '500px';
                iframe.style.border = 'none';
                uploadedFileDiv.appendChild(iframe);
            }
        }

        document.getElementById('scheduleForm').onsubmit = async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            await fetch('/schedule', {
                method: 'POST',
                body: formData
            });
            
            // Fetch and display updated uploaded file
            await fetchUploadedFile();
        };

        // Fetch and display uploaded file on page load
        window.onload = fetchUploadedFile;

</script>
  
</body>
</html>
